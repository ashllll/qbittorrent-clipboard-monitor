# 软件开发综合规范

---
type: "统一开发标准"
last_updated: "2025-08-15"
---

## Part 1: 通用开发规则（语言无关）

### 🎯 核心开发原则

#### 原则 1：完整性和质量要求
**触发条件：** 所有开发和测试任务

**执行规则：**
- MUST 实现完整功能，不创建简化版或精简版
- MUST 编写全面的测试用例，覆盖核心功能和边界情况
- MUST 确保所有测试100%通过率
- MUST 直接解决问题，不采用规避或绕过方式

**智能MCP增强（自动触发）：**
- **问题分析**: Sequential Thinking 系统化分解复杂问题
- **技术查询**: Context7 实时获取最新文档和解决方案
- **代码管理**: Git/GitHub MCP 智能版本控制和协作
- **数据处理**: Database MCP 高效数据查询和分析
- **知识记录**: Memory MCP 持久化经验和决策过程

### 📚 知识管理和文档

#### 原则 2：文档查询和知识获取
**触发条件：**
- 使用新技术或框架
- 遇到未知API或库
- 需要最佳实践指导
- 处理版本升级

**基础执行规则：**
- MUST 在实现前查询相关技术文档
- MUST 验证文档的时效性和适用版本
- SHOULD 记录关键技术决策和依据

**智能MCP增强（关键词自动触发）：**
```
Context7 自动启用 (触发词: 文档、API、库、框架、如何使用):
- 实时查询最新技术文档和API示例
- 获取库的已知问题和最佳解决方案  
- 自动检索性能优化和安全建议
- 版本兼容性检查和迁移指南

Memory MCP 协同记录:
- 保存重要技术决策和依据
- 建立项目特定的知识库
- 关联相似问题的解决历史
```

### 🧠 问题分析和架构设计

#### 原则 3：系统化问题分析
**触发条件：**
- 复杂技术决策
- 多步骤问题解决
- 系统架构设计
- 疑难问题诊断

**基础执行规则：**
- MUST 将复杂问题分解为子问题
- MUST 按逻辑顺序分析
- SHOULD 评估多种解决方案

**智能MCP增强（复杂度自动检测）：**
```
Sequential Thinking 强制启用 (触发词: 架构、设计、系统、复杂):
- 自动识别问题复杂度并分解为子问题
- 建立完整的分析链路和决策树
- 实时评估和修正思考逻辑
- 生成多个方案并进行对比验证

协同服务自动组合:
- Context7: 并行查询相关技术方案
- Memory MCP: 记录分析过程和最终决策
- Database MCP: 验证数据支撑和约束条件
- Git MCP: 检查历史实现和经验教训
```

### ✅ 测试和验证

#### 原则 4：全面测试策略
**触发条件：**
- 新功能开发
- 代码重构
- 缺陷修复
- 发布前验证

**基础执行规则：**
- MUST 编写单元测试
- MUST 实现集成测试
- SHOULD 包含端到端测试
- SHOULD 性能测试

**智能MCP测试生态（场景自动识别）：**
```
Playwright 自动启用 (触发词: 测试、UI、界面、浏览器):
- 智能录制用户交互流程
- 自动生成跨浏览器兼容性测试
- 端到端用户流程验证和回归测试
- 可视化测试结果和性能监控

全栈测试协同:
- Database MCP: 数据一致性和完整性测试
- Git MCP: 测试历史和回归分析
- Memory MCP: 测试用例管理和结果记录
- Time MCP: 性能基准和响应时间监控
- Filesystem MCP: 文件操作和权限测试
```

### ⏱️ 数据和时间处理

#### 原则 5：时间和外部数据管理
**时间处理规则：**
- MUST 使用标准时间格式（ISO 8601）
- MUST 考虑时区和夏令时
- SHOULD 统一使用UTC存储

**外部数据获取：**
- MUST 实现异常处理和超时
- MUST 验证数据格式
- SHOULD 实现重试机制

**智能MCP数据处理生态（自动识别数据类型）：**
```
Time MCP 精确处理 (触发词: 时间、时区、日期、性能):
- 智能时区检测和自动转换
- 高精度性能基准测试和监控
- 定时任务调度和时间序列分析
- 跨地区协作的时间同步

数据获取和处理链：
- Fetch MCP: 外部API数据获取和内容抓取
- Database MCP: 结构化数据存储和复杂查询
- Filesystem MCP: 文件系统数据管理和批处理
- Memory MCP: 数据处理历史和模式识别

外部集成服务：
- GitHub MCP: 代码仓库数据和统计分析
- Notion MCP: 项目数据管理和团队协作
- Obsidian MCP: 知识图谱构建和关联分析
```

## Part 2: 项目文件结构规范

### 📁 标准项目结构

```
project-root/
├── src/                    # 源代码
│   ├── components/         # 组件/模块
│   ├── utils/             # 工具函数
│   ├── services/          # 业务逻辑/服务
│   └── config/            # 配置文件
│
├── test/                   # 测试文件（或 tests/）
│   ├── unit/              # 单元测试
│   │   └── [镜像src结构]
│   ├── integration/       # 集成测试
│   ├── e2e/              # 端到端测试
│   ├── performance/       # 性能测试
│   ├── fixtures/         # 测试数据
│   └── mocks/            # 模拟对象
│
├── docs/                  # 文档
│   ├── api/              # API文档
│   ├── guides/           # 使用指南
│   └── architecture/     # 架构文档
│
├── scripts/              # 构建/部署脚本
├── config/               # 项目配置
├── dist/                 # 构建输出（或 build/）
├── coverage/             # 测试覆盖率报告
└── .github/              # CI/CD配置
```

### 🧪 测试文件组织规则

#### 测试文件命名
```
- 单元测试：[filename].test.[ext] 或 [filename].spec.[ext]
- 集成测试：[feature].integration.test.[ext]
- E2E测试：[scenario].e2e.test.[ext]
```

#### 测试文件位置
```
源文件：src/utils/validator.js
对应测试：test/unit/utils/validator.test.js
```

#### 测试组织原则
- MUST 测试文件结构镜像源代码结构
- MUST 分离不同类型的测试
- SHOULD 测试数据独立于测试代码
- SHOULD 慢速测试单独分类
- MAY 在源文件同目录放置 __tests__ 文件夹（小项目）

#### 测试配置管理
```
test/
├── setup.js              # 测试环境设置
├── teardown.js           # 测试清理
└── config/
    ├── jest.config.js    # 测试框架配置
    └── .env.test         # 测试环境变量
```

## Part 3: MCP工具增强规则（当可用时）

### 🔧 MCP服务使用规则

#### Rule 1: Context 7 服务 - 文档和知识获取
**触发条件：**
- 遇到未知或不熟悉的库/框架
- 需要查找API文档或代码示例
- 出现库相关的错误或警告
- 计划升级依赖版本

**执行规则：**
- MUST 先调用 `resolve-library-id` 获取库ID
- MUST 在编写新功能前查询相关库文档
- SHOULD 查询库的最佳实践和性能建议
- SHOULD 验证代码示例的时效性

#### Rule 2: Sequential Thinking 服务 - 问题分析
**触发条件：**
- 面临复杂的技术决策
- 需要分析多步骤问题
- 系统架构设计或重构
- 复杂bug的根因分析

**执行规则：**
- MUST 设置合理的思考步骤数
- MUST 记录每个思考步骤
- SHOULD 利用修正和分支功能
- SHOULD 生成和验证解决假设

#### Rule 3: Playwright 服务 - 自动化测试
**触发条件：**
- 开发Web界面功能
- 需要端到端测试
- UI交互测试需求
- 浏览器兼容性测试

**执行规则：**
- MUST 使用codegen录制测试脚本
- MUST 包含断言验证
- SHOULD 测试多浏览器
- SHOULD 截图记录关键步骤

#### Rule 4: Time 服务 - 时间处理
**触发条件：**
- 处理时间戳和日期计算
- 跨时区数据处理
- 定时任务和调度

**执行规则：**
- MUST 使用标准IANA时区名称
- MUST 考虑夏令时变化
- SHOULD 默认使用Asia/Shanghai作为本地时区

#### Rule 5: Fetch 服务 - 数据获取
**触发条件：**
- 需要获取外部数据
- API接口测试
- 网页内容抓取

**执行规则：**
- MUST 设置合理的max_length
- SHOULD 选择合适的格式（HTML/Markdown/JSON/Text）
- SHOULD 处理分页（使用start_index）

### 🔄 MCP工具组合工作流

#### 开发实现工作流
```序列
1. Sequential Thinking → 分析需求和设计方案
2. Context 7 → 查询相关API文档
3. 实现代码
4. Playwright → 自动化测试
5. Fetch → 验证外部接口
```

#### 问题诊断工作流
```序列
1. Sequential Thinking → 问题分解
2. Context 7 → 查询已知问题
3. Fetch → 获取补充信息
4. 实现修复
5. Playwright → 验证修复
```

#### 并行优化
**可并行执行：**
- Context 7查询 + Fetch数据获取
- 不同类型的测试执行
- 文档查询 + 问题分析

**必须串行执行：**
- resolve-library-id → get-library-docs
- 问题分析 → 解决方案实施
- 代码实现 → 测试验证

### 📊 质量保证和度量

#### 代码质量标准
- 代码覆盖率 > 80%
- 圈复杂度 < 10
- 重复代码 < 5%
- 文档覆盖率 > 90%

#### 持续改进
- 定期代码审查
- 性能基准测试
- 安全漏洞扫描
- 依赖更新检查

### 🚨 错误处理和日志

#### 错误处理规范
```
try {
  // 业务逻辑
} catch (error) {
  // 1. 记录错误日志
  // 2. 清理资源
  // 3. 友好错误提示
  // 4. 降级处理（如可能）
}
```

#### 日志级别
- ERROR: 系统错误，需要立即处理
- WARN: 潜在问题，需要关注
- INFO: 重要业务事件
- DEBUG: 调试信息（生产环境禁用）

---

## 使用说明

1. **基础规则**适用于所有项目和编程语言
2. **MCP增强规则**在工具可用时自动应用
3. **项目结构**可根据具体框架调整
4. **测试策略**根据项目规模选择合适的组织方式

## 优先级说明

- **MUST**: 必须执行，影响代码正确性
- **SHOULD**: 应该执行，提升代码质量
- **MAY**: 可以执行，优化和最佳实践

## 📋 个人项目开发管理

### 日常开发清单

#### 开始新功能
- [ ] 分析需求，分解任务
- [ ] 查询相关文档
- [ ] 设计技术方案
- [ ] 创建功能分支
- [ ] 实现代码
- [ ] 编写测试
- [ ] 代码审查（自审）
- [ ] 合并到主分支

#### 修复Bug
- [ ] 复现问题
- [ ] 分析根因
- [ ] 查询已知问题
- [ ] 编写失败测试
- [ ] 修复代码
- [ ] 验证测试通过
- [ ] 回归测试

### 🎯 优先级决策矩阵

| 紧急度/重要度 | 重要 | 不重要 |
|-------------|------|--------|
| **紧急** | 立即处理：生产问题、安全漏洞 | 委托或推迟：小优化 |
| **不紧急** | 计划执行：新功能、重构 | 记录待办：文档更新 |

### 📊 质量门禁

#### 每次提交必须通过
- ✅ 代码格式化（自动）
- ✅ 单元测试（< 5分钟）
- ✅ 代码覆盖率 > 80%

#### 每日检查
- ✅ 集成测试通过
- ✅ 无新的安全警告
- ✅ 依赖无已知漏洞

#### 发布前验证
- ✅ 全部测试通过
- ✅ 性能基准达标
- ✅ E2E测试完成
- ✅ 文档已更新

### 📈 个人效率指标

#### 每周跟踪
- 完成的功能点数量
- Bug修复时间（平均）
- 测试覆盖率趋势
- 文档更新频率

#### 每月回顾
- 技术债务清理
- 性能优化成果
- 学习新技术进展
- 项目里程碑达成

### 💡 最佳实践提醒

#### 每日开始
- 查看CI/CD状态
- 处理紧急问题
- 规划当日任务

#### 每次提交前
- 运行本地测试
- 自查代码质量
- 更新相关文档

#### 每周结束
- 清理技术债务
- 更新依赖版本
- 备份重要数据

### 🚨 紧急情况处理

1. **生产环境崩溃**：回滚 → 分析 → 修复 → 测试 → 重新部署
2. **数据丢失**：停止写入 → 备份现状 → 恢复数据 → 验证完整性
3. **安全漏洞**：隔离影响 → 临时补丁 → 永久修复 → 安全审计

---

**文档版本**: 3.0  
**更新日期**: 2025-08-15  
**适用范围**: 所有编程语言和技术栈  
**整合内容**: 原通用规则.md + 项目开发管理.md
