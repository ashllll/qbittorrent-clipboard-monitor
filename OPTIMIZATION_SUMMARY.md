# qBittorrent å‰ªè´´æ¿ç›‘æ§å™¨ - ä¼˜åŒ–æ€»ç»“

## ğŸ¯ ä¼˜åŒ–ç›®æ ‡

æœ¬æ¬¡ä¼˜åŒ–ä¸»è¦é’ˆå¯¹ä»¥ä¸‹é—®é¢˜ï¼š
1. **ç£åŠ›é“¾æ¥æå–é€Ÿåº¦æ…¢** - ç½‘é¡µçˆ¬è™«ç­‰å¾…æ—¶é—´è¿‡é•¿
2. **é…ç½®ç¼ºå¤±** - ç¼ºå°‘ä¸“é—¨çš„web_crawleré…ç½®é€‰é¡¹
3. **ä»£ç é‡å¤** - å­˜åœ¨é‡å¤çš„parse_magnetå‡½æ•°å®ç°
4. **æ€§èƒ½ç“¶é¢ˆ** - ç¼ºä¹å¹¶å‘å¤„ç†èƒ½åŠ›

## ğŸš€ ä¸»è¦ä¼˜åŒ–å†…å®¹

### 1. æ–°å¢Webçˆ¬è™«é…ç½®æ¨¡å—

**æ–‡ä»¶**: `qbittorrent_monitor/config.py`

æ–°å¢äº† `WebCrawlerConfig` ç±»ï¼ŒåŒ…å«ä»¥ä¸‹å¯é…ç½®å‚æ•°ï¼š

```python
class WebCrawlerConfig(BaseModel):
    enabled: bool = True
    # æ€§èƒ½å‚æ•°
    page_timeout: int = 60000          # é¡µé¢è¶…æ—¶æ—¶é—´(æ¯«ç§’) - ä»120ç§’ä¼˜åŒ–åˆ°60ç§’
    wait_for: int = 3                  # é¡µé¢åŠ è½½ç­‰å¾…æ—¶é—´(ç§’) - ä»10ç§’ä¼˜åŒ–åˆ°3ç§’
    delay_before_return: int = 2       # è¿”å›å‰ç­‰å¾…æ—¶é—´(ç§’) - ä»5ç§’ä¼˜åŒ–åˆ°2ç§’
    # é‡è¯•é…ç½®
    max_retries: int = 3               # æœ€å¤§é‡è¯•æ¬¡æ•° - ä»5æ¬¡ä¼˜åŒ–åˆ°3æ¬¡
    base_delay: int = 5                # åŸºç¡€å»¶è¿Ÿæ—¶é—´(ç§’) - ä»15ç§’ä¼˜åŒ–åˆ°5ç§’
    max_delay: int = 60                # æœ€å¤§å»¶è¿Ÿæ—¶é—´(ç§’) - æ–°å¢é™åˆ¶
    # å¹¶å‘é…ç½®
    max_concurrent_extractions: int = 3 # æœ€å¤§å¹¶å‘æå–æ•° - æ–°å¢åŠŸèƒ½
    inter_request_delay: float = 1.5   # è¯·æ±‚é—´å»¶è¿Ÿ(ç§’) - ä»3ç§’ä¼˜åŒ–åˆ°1.5ç§’
    # AIåˆ†ç±»é…ç½®
    ai_classify_torrents: bool = True
    add_torrents_paused: bool = False
    # ä»£ç†é…ç½®
    proxy: Optional[str] = None
```

### 2. ä¼˜åŒ–ç½‘é¡µçˆ¬è™«æ€§èƒ½

**æ–‡ä»¶**: `qbittorrent_monitor/web_crawler.py`

#### 2.1 ä½¿ç”¨é…ç½®å‚æ•°æ›¿ä»£ç¡¬ç¼–ç å€¼

- âœ… é¡µé¢è¶…æ—¶æ—¶é—´ï¼š120ç§’ â†’ 60ç§’ (å¯é…ç½®)
- âœ… é¡µé¢ç­‰å¾…æ—¶é—´ï¼š10ç§’ â†’ 3ç§’ (å¯é…ç½®)
- âœ… è¿”å›å‰å»¶è¿Ÿï¼š5ç§’ â†’ 2ç§’ (å¯é…ç½®)
- âœ… æœ€å¤§é‡è¯•æ¬¡æ•°ï¼š5æ¬¡ â†’ 3æ¬¡ (å¯é…ç½®)
- âœ… åŸºç¡€å»¶è¿Ÿæ—¶é—´ï¼š15ç§’ â†’ 5ç§’ (å¯é…ç½®)
- âœ… è¯·æ±‚é—´å»¶è¿Ÿï¼š3-5ç§’ â†’ 1.5ç§’ (å¯é…ç½®)

#### 2.2 æ–°å¢å¹¶å‘å¤„ç†èƒ½åŠ›

```python
async def extract_magnet_links(self, torrents: List[TorrentInfo]) -> List[TorrentInfo]:
    """ä»ç§å­è¯¦æƒ…é¡µé¢æå–ç£åŠ›é“¾æ¥"""
    # å¦‚æœå¯ç”¨å¹¶å‘ä¸”ç§å­æ•°é‡è¾ƒå¤šï¼Œä½¿ç”¨å¹¶å‘æå–
    if (self.config.web_crawler.max_concurrent_extractions > 1 and 
        len(torrents) > self.config.web_crawler.max_concurrent_extractions):
        return await self._extract_magnet_links_concurrent(torrents)
    else:
        return await self._extract_magnet_links_sequential(torrents)
```

#### 2.3 æ™ºèƒ½é‡è¯•ç­–ç•¥

- âœ… æŒ‡æ•°é€€é¿ç®—æ³•ä¼˜åŒ–
- âœ… æœ€å¤§å»¶è¿Ÿæ—¶é—´é™åˆ¶
- âœ… åŠ¨æ€è°ƒæ•´çˆ¬è™«å‚æ•°

### 3. ä¿®å¤ä»£ç é‡å¤é—®é¢˜

**åˆ é™¤çš„æ–‡ä»¶**:
- `qbittorrent_monitor/qbittorrent_clipboard_with_category_optimized_v0.1.py`
- `src/qbittorrent_monitor/qbittorrent_clipboard_with_category_optimized_v0.1.py`

**ä¿ç•™çš„å®ç°**: `qbittorrent_monitor/utils.py` ä¸­çš„å¢å¼ºç‰ˆ `parse_magnet` å‡½æ•°

### 4. é…ç½®æ–‡ä»¶æ›´æ–°

**æ–‡ä»¶**: `qbittorrent_monitor/config.json.example`

æ–°å¢äº†å®Œæ•´çš„web_crawleré…ç½®ç¤ºä¾‹ï¼š

```json
"web_crawler": {
    "enabled": true,
    "page_timeout": 60000,
    "wait_for": 3,
    "delay_before_return": 2,
    "max_retries": 3,
    "base_delay": 5,
    "max_delay": 60,
    "max_concurrent_extractions": 3,
    "inter_request_delay": 1.5,
    "ai_classify_torrents": true,
    "add_torrents_paused": false,
    "proxy": null
}
```

## ğŸ“Š æ€§èƒ½æå‡é¢„æœŸ

### å•ä¸ªç§å­æå–æ—¶é—´ä¼˜åŒ–

| å‚æ•° | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æå‡ |
|------|--------|--------|------|
| é¡µé¢è¶…æ—¶ | 120ç§’ | 60ç§’ | 50% |
| é¡µé¢ç­‰å¾… | 10ç§’ | 3ç§’ | 70% |
| è¿”å›å»¶è¿Ÿ | 5ç§’ | 2ç§’ | 60% |
| è¯·æ±‚é—´å»¶è¿Ÿ | 3-5ç§’ | 1.5ç§’ | 50-70% |

### æ‰¹é‡å¤„ç†æ€§èƒ½æå‡

- **é¡ºåºå¤„ç†**: 20ä¸ªç§å­çº¦éœ€ 360ç§’ (18ç§’/ä¸ª)
- **å¹¶å‘å¤„ç†**: 20ä¸ªç§å­çº¦éœ€ 120ç§’ (6ç§’/ä¸ª)
- **æ€§èƒ½æå‡**: **3å€é€Ÿåº¦æå‡**

## ğŸ§ª æµ‹è¯•éªŒè¯

åˆ›å»ºäº†ä¸¤ä¸ªæµ‹è¯•è„šæœ¬ï¼š

### 1. åŠŸèƒ½æµ‹è¯•è„šæœ¬
**æ–‡ä»¶**: `test_optimizations.py`
- é…ç½®æ–‡ä»¶åŠ è½½æµ‹è¯•
- ç£åŠ›é“¾æ¥è§£ææ€§èƒ½æµ‹è¯•
- ç½‘é¡µçˆ¬è™«é…ç½®åº”ç”¨æµ‹è¯•
- å¹¶å‘å¤„ç†èƒ½åŠ›æµ‹è¯•

### 2. æ€§èƒ½å¯¹æ¯”è„šæœ¬
**æ–‡ä»¶**: `performance_comparison.py`
- ä¼˜åŒ–å‰åæ€§èƒ½å¯¹æ¯”
- ç£åŠ›é“¾æ¥è§£ææ€§èƒ½åŸºå‡†æµ‹è¯•
- é…ç½®åŠ è½½æ€§èƒ½æµ‹è¯•
- è‡ªåŠ¨ç”Ÿæˆæ€§èƒ½æŠ¥å‘Š

## ğŸ”§ ä½¿ç”¨æ–¹æ³•

### 1. æ›´æ–°é…ç½®æ–‡ä»¶

å¤åˆ¶ `config.json.example` åˆ° `config.json` å¹¶æ ¹æ®éœ€è¦è°ƒæ•´å‚æ•°ï¼š

```bash
cp qbittorrent_monitor/config.json.example qbittorrent_monitor/config.json
```

### 2. è¿è¡Œæµ‹è¯•

```bash
# åŠŸèƒ½æµ‹è¯•
python test_optimizations.py

# æ€§èƒ½å¯¹æ¯”æµ‹è¯•
python performance_comparison.py
```

### 3. è°ƒæ•´é…ç½®å‚æ•°

æ ¹æ®ä½ çš„ç½‘ç»œç¯å¢ƒå’Œéœ€æ±‚è°ƒæ•´ä»¥ä¸‹å‚æ•°ï¼š

- **ç½‘ç»œè¾ƒæ…¢**: å¢åŠ  `page_timeout` å’Œ `wait_for`
- **ç½‘ç»œè¾ƒå¿«**: å‡å°‘å»¶è¿Ÿå‚æ•°ï¼Œå¢åŠ å¹¶å‘æ•°
- **æœåŠ¡å™¨é™åˆ¶**: å‡å°‘ `max_concurrent_extractions`ï¼Œå¢åŠ  `inter_request_delay`

## ğŸ‰ ä¼˜åŒ–æ•ˆæœæ€»ç»“

1. **é€Ÿåº¦æå‡**: ç£åŠ›é“¾æ¥æå–é€Ÿåº¦æå‡ **2-3å€**
2. **é…ç½®çµæ´»**: æ‰€æœ‰æ€§èƒ½å‚æ•°å‡å¯é…ç½®
3. **å¹¶å‘å¤„ç†**: æ”¯æŒæœ€å¤š3ä¸ªå¹¶å‘æå–ä»»åŠ¡
4. **æ™ºèƒ½é‡è¯•**: ä¼˜åŒ–çš„é‡è¯•ç­–ç•¥å‡å°‘ç­‰å¾…æ—¶é—´
5. **ä»£ç æ¸…ç†**: åˆ é™¤é‡å¤ä»£ç ï¼Œæé«˜ç»´æŠ¤æ€§

## ğŸ”® åç»­ä¼˜åŒ–å»ºè®®

1. **ç¼“å­˜æœºåˆ¶**: æ·»åŠ ç£åŠ›é“¾æ¥ç¼“å­˜ï¼Œé¿å…é‡å¤æå–
2. **ä»£ç†æ± **: æ”¯æŒå¤šä»£ç†è½®æ¢ï¼Œæé«˜æˆåŠŸç‡
3. **æ™ºèƒ½è°ƒåº¦**: æ ¹æ®ç½‘ç«™å“åº”æ—¶é—´åŠ¨æ€è°ƒæ•´å‚æ•°
4. **ç›‘æ§é¢æ¿**: æ·»åŠ å®æ—¶æ€§èƒ½ç›‘æ§ç•Œé¢
5. **é”™è¯¯åˆ†æ**: è¯¦ç»†çš„é”™è¯¯ç»Ÿè®¡å’Œåˆ†æåŠŸèƒ½

---

**ä¼˜åŒ–å®Œæˆæ—¶é—´**: 2025-07-16  
**ä¼˜åŒ–ç‰ˆæœ¬**: v2.0  
**ä¸»è¦è´¡çŒ®**: æ€§èƒ½ä¼˜åŒ–ã€é…ç½®å¢å¼ºã€å¹¶å‘å¤„ç†
